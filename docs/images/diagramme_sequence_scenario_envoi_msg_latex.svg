<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1599px" preserveAspectRatio="none" style="width:2606px;height:1599px;" version="1.1" viewBox="0 0 2606 1599" width="2606px" zoomAndPan="magnify"><defs><filter height="300%" id="f1g3kq3zioq744" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="423" x="1087" y="29.2419">Scénario d'Envoi d'un Message Texte dans le Chat</text><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328.5" y="206.9958"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328.5" y="632.174"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328.5" y="772.9981"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328.5" y="1455.1184"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="393.4722" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="728.5" y="238.7018"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="349.0602" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="728.5" y="804.7041"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="76.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="728.5" y="1378.7064"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="95.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1239" y="270.4078"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="190.2361" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1449.5" y="925.8221"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="158.5301" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1891" y="441.9379"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="126.8241" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1891" y="957.5282"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="63.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2257" y="989.2342"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="26" x2="26" y1="127.5838" y2="1504.8244"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="333" x2="333" y1="127.5838" y2="1504.8244"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="733.5" x2="733.5" y1="127.5838" y2="1504.8244"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1057" x2="1057" y1="127.5838" y2="1504.8244"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1244" x2="1244" y1="127.5838" y2="1504.8244"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1454" x2="1454" y1="127.5838" y2="1504.8244"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1681" x2="1681" y1="127.5838" y2="1504.8244"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1896" x2="1896" y1="127.5838" y2="1504.8244"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2262" x2="2262" y1="127.5838" y2="1504.8244"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2533" x2="2533" y1="127.5838" y2="1504.8244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="8" y="123.4818">User</text><ellipse cx="26.5" cy="51.5158" fill="#FEFECE" filter="url(#f1g3kq3zioq744)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M26.5,59.5158 L26.5,86.5158 M13.5,67.5158 L39.5,67.5158 M26.5,86.5158 L13.5,101.5158 M26.5,86.5158 L39.5,101.5158 " fill="none" filter="url(#f1g3kq3zioq744)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="8" y="1518.7904">User</text><ellipse cx="26.5" cy="1532.8923" fill="#FEFECE" filter="url(#f1g3kq3zioq744)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M26.5,1540.8923 L26.5,1567.8923 M13.5,1548.8923 L39.5,1548.8923 M26.5,1567.8923 L13.5,1582.8923 M26.5,1567.8923 L39.5,1582.8923 " fill="none" filter="url(#f1g3kq3zioq744)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="105" x="279" y="70.4479"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="293" y="92.4139">ChatScreen</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="286" y="111.4818">(Composable)</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="105" x="279" y="1503.8244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="293" y="1525.7904">ChatScreen</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="286" y="1544.8583">(Composable)</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="672.5" y="89.5158"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="679.5" y="111.4818">ChatViewModel</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="672.5" y="1503.8244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="679.5" y="1525.7904">ChatViewModel</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="997" y="70.4479"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1004" y="92.4139">AuthRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="1021" y="111.4818">(Interface)</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="997" y="1503.8244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1004" y="1525.7904">AuthRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="1021" y="1544.8583">(Interface)</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1168" y="70.4479"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="1175" y="92.4139">AuthRepositoryImpl</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="1222.5" y="111.4818">(Data)</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1168" y="1503.8244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="1175" y="1525.7904">AuthRepositoryImpl</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="1222.5" y="1544.8583">(Data)</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="1370" y="89.5158"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="1377" y="111.4818">SendMessageUseCase</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="1370" y="1503.8244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="1377" y="1525.7904">SendMessageUseCase</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="145" x="1607" y="70.4479"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="1614" y="92.4139">MessageRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="1645" y="111.4818">(Interface)</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="145" x="1607" y="1503.8244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="1614" y="1525.7904">MessageRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="1645" y="1544.8583">(Interface)</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="1806" y="70.4479"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="1813" y="92.4139">MessageRepositoryImpl</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="1874.5" y="111.4818">(Data)</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="1806" y="1503.8244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="1813" y="1525.7904">MessageRepositoryImpl</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="1874.5" y="1544.8583">(Data)</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2201" y="89.5158"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2208" y="111.4818">FirestoreHelper</text><rect fill="#FEFECE" filter="url(#f1g3kq3zioq744)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2201" y="1503.8244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2208" y="1525.7904">FirestoreHelper</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="2501.5" y="104.4139">Firebase</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="2489" y="123.4818">Firestore DB</text><path d="M2515,53.4479 C2515,43.4479 2533,43.4479 2533,43.4479 C2533,43.4479 2551,43.4479 2551,53.4479 L2551,79.4479 C2551,89.4479 2533,89.4479 2533,89.4479 C2533,89.4479 2515,89.4479 2515,79.4479 L2515,53.4479 " fill="#FEFECE" filter="url(#f1g3kq3zioq744)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2515,53.4479 C2515,63.4479 2533,63.4479 2533,63.4479 C2533,63.4479 2551,63.4479 2551,53.4479 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="2501.5" y="1518.7904">Firebase</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="2489" y="1537.8583">Firestore DB</text><path d="M2515,1551.9603 C2515,1541.9603 2533,1541.9603 2533,1541.9603 C2533,1541.9603 2551,1541.9603 2551,1551.9603 L2551,1577.9603 C2551,1587.9603 2533,1587.9603 2533,1587.9603 C2533,1587.9603 2515,1587.9603 2515,1577.9603 L2515,1551.9603 " fill="#FEFECE" filter="url(#f1g3kq3zioq744)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2515,1551.9603 C2515,1561.9603 2533,1561.9603 2533,1561.9603 C2533,1561.9603 2551,1561.9603 2551,1551.9603 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328.5" y="206.9958"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328.5" y="632.174"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328.5" y="772.9981"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328.5" y="1455.1184"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="393.4722" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="728.5" y="238.7018"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="349.0602" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="728.5" y="804.7041"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="76.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="728.5" y="1378.7064"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="95.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1239" y="270.4078"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="190.2361" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1449.5" y="925.8221"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="158.5301" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1891" y="441.9379"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="126.8241" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1891" y="957.5282"/><rect fill="#FFFFFF" filter="url(#f1g3kq3zioq744)" height="63.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2257" y="989.2342"/><rect fill="#EEEEEE" filter="url(#f1g3kq3zioq744)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2591" x="3" y="159.4368"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2594" y1="159.4368" y2="159.4368"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2594" y1="162.4368" y2="162.4368"/><rect fill="#EEEEEE" filter="url(#f1g3kq3zioq744)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="459" x="1069" y="147.5838"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="442" x="1075" y="165.4808">Phase 1: Initialisation (Chargement de l'utilisateur et des messages)</text><polygon fill="#A80036" points="316.5,202.9958,326.5,206.9958,316.5,210.9958,320.5,206.9958" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26.5" x2="322.5" y1="206.9958" y2="206.9958"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="77" y="201.1868">Accède à l'écran de chat (groupId)</text><polygon fill="#A80036" points="716.5,234.7018,726.5,238.7018,716.5,242.7018,720.5,238.7018" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="333.5" x2="722.5" y1="238.7018" y2="238.7018"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="411.5" y="232.8928">Initialisation (collecte uiState, messages)</text><polygon fill="#A80036" points="1045.5,266.4078,1055.5,270.4078,1045.5,274.4078,1049.5,270.4078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="738.5" x2="1051.5" y1="270.4078" y2="270.4078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="847" y="264.5988">getCurrentUser()</text><polygon fill="#A80036" points="2250,298.1138,2260,302.1138,2250,306.1138,2254,302.1138" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1249" x2="2256" y1="302.1138" y2="302.1138"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1644" y="296.3048">getDocument("users", currentUserId)</text><polygon fill="#A80036" points="1260,329.8199,1250,333.8199,1260,337.8199,1256,333.8199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1254" x2="2261" y1="333.8199" y2="333.8199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="1741.5" y="328.0109">User</text><polygon fill="#A80036" points="749.5,361.5259,739.5,365.5259,749.5,369.5259,745.5,365.5259" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="743.5" x2="1243" y1="365.5259" y2="365.5259"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="927.75" y="359.7169">Flow&lt;Result&lt;User?&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="738.5" x2="780.5" y1="397.2319" y2="397.2319"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="780.5" x2="780.5" y1="397.2319" y2="410.2319"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="780.5" y1="410.2319" y2="410.2319"/><polygon fill="#A80036" points="749.5,406.2319,739.5,410.2319,749.5,414.2319,745.5,410.2319" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="745.5" y="391.4229">Met à jour uiState.currentUserName</text><polygon fill="#A80036" points="1669.5,437.9379,1679.5,441.9379,1669.5,445.9379,1673.5,441.9379" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="738.5" x2="1675.5" y1="441.9379" y2="441.9379"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="1113" y="436.1289">getMessagesForGroup(groupId)</text><polygon fill="#A80036" points="2250,469.6439,2260,473.6439,2250,477.6439,2254,473.6439" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1901" x2="2256" y1="473.6439" y2="473.6439"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1952.5" y="467.8349">getCollection("groups/groupId/messages")</text><polygon fill="#A80036" points="2521,501.3499,2531,505.3499,2521,509.3499,2525,505.3499" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2262" x2="2527" y1="505.3499" y2="505.3499"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="2291" y="499.5409">Lit messages en temps réel (écoute)</text><polygon fill="#A80036" points="2273,533.056,2263,537.056,2273,541.056,2269,537.056" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="2267" x2="2532" y1="537.056" y2="537.056"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="2274" y="531.247">Liste de Messages (initiale et mises à jour)</text><polygon fill="#A80036" points="1912,564.762,1902,568.762,1912,572.762,1908,568.762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1906" x2="2261" y1="568.762" y2="568.762"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="2016.5" y="562.953">Flow&lt;List&lt;Message&gt;&gt;</text><polygon fill="#A80036" points="749.5,596.468,739.5,600.468,749.5,604.468,745.5,600.468" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="743.5" x2="1895" y1="600.468" y2="600.468"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1252.25" y="594.659">Flow&lt;List&lt;Message&gt;&gt;</text><polygon fill="#A80036" points="349.5,628.174,339.5,632.174,349.5,636.174,345.5,632.174" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="343.5" x2="732.5" y1="632.174" y2="632.174"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="442.5" y="626.365">Met à jour la liste des messages</text><polygon fill="#A80036" points="37.5,659.88,27.5,663.88,37.5,667.88,33.5,663.88" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31.5" x2="332.5" y1="663.88" y2="663.88"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="101" y="658.071">Affiche l'historique du chat</text><rect fill="#EEEEEE" filter="url(#f1g3kq3zioq744)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2591" x="3" y="693.733"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2594" y1="693.733" y2="693.733"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2594" y1="696.733" y2="696.733"/><rect fill="#EEEEEE" filter="url(#f1g3kq3zioq744)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="244" x="1176.5" y="681.88"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="1182.5" y="699.777">Phase 2: Saisie et Envoi du Message</text><polygon fill="#A80036" points="321.5,737.2921,331.5,741.2921,321.5,745.2921,325.5,741.2921" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26.5" x2="327.5" y1="741.2921" y2="741.2921"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="100.5" y="735.4831">Saisit "Bonjour le groupe !"</text><polygon fill="#A80036" points="316.5,768.9981,326.5,772.9981,316.5,776.9981,320.5,772.9981" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26.5" x2="322.5" y1="772.9981" y2="772.9981"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="86.5" y="767.1891">Clique sur le bouton "Envoyer"</text><polygon fill="#A80036" points="716.5,800.7041,726.5,804.7041,716.5,808.7041,720.5,804.7041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="333.5" x2="722.5" y1="804.7041" y2="804.7041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="423.5" y="798.8951">sendMessage("Bonjour le groupe !")</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="738.5" x2="780.5" y1="836.4101" y2="836.4101"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="780.5" x2="780.5" y1="836.4101" y2="849.4101"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="780.5" y1="849.4101" y2="849.4101"/><polygon fill="#A80036" points="749.5,845.4101,739.5,849.4101,749.5,853.4101,745.5,849.4101" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="300" x="745.5" y="830.6011">Crée l'objet Message (avec senderId, senderName)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="738.5" x2="780.5" y1="881.1161" y2="881.1161"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="780.5" x2="780.5" y1="881.1161" y2="894.1161"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="780.5" y1="894.1161" y2="894.1161"/><polygon fill="#A80036" points="749.5,890.1161,739.5,894.1161,749.5,898.1161,745.5,894.1161" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="745.5" y="875.3071">Met à jour uiState (sendMessageError = null)</text><polygon fill="#A80036" points="1437.5,921.8221,1447.5,925.8221,1437.5,929.8221,1441.5,925.8221" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="738.5" x2="1443.5" y1="925.8221" y2="925.8221"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="1016" y="920.0131">invoke(groupId, message)</text><polygon fill="#A80036" points="1669.5,953.5282,1679.5,957.5282,1669.5,961.5282,1673.5,957.5282" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1459.5" x2="1675.5" y1="957.5282" y2="957.5282"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="1471.5" y="951.7192">sendMessage(groupId, message)</text><polygon fill="#A80036" points="2245,985.2342,2255,989.2342,2245,993.2342,2249,989.2342" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1901" x2="2251" y1="989.2342" y2="989.2342"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="1917" y="983.4252">addDocument("groups/groupId/messages", message)</text><polygon fill="#A80036" points="2521,1016.9402,2531,1020.9402,2521,1024.9402,2525,1020.9402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2267" x2="2527" y1="1020.9402" y2="1020.9402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="2324.5" y="1015.1312">Écrit le nouveau message</text><polygon fill="#A80036" points="2273,1048.6462,2263,1052.6462,2273,1056.6462,2269,1052.6462" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="2267" x2="2532" y1="1052.6462" y2="1052.6462"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2328" y="1046.8372">Confirmation d'écriture</text><polygon fill="#A80036" points="1470.5,1080.3522,1460.5,1084.3522,1470.5,1088.3522,1466.5,1084.3522" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1464.5" x2="1895" y1="1084.3522" y2="1084.3522"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="1573.25" y="1078.5432">Flow&lt;Result&lt;Unit&gt;&gt; (Succès/Échec)</text><polygon fill="#A80036" points="749.5,1112.0582,739.5,1116.0582,749.5,1120.0582,745.5,1116.0582" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="743.5" x2="1453.5" y1="1116.0582" y2="1116.0582"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="992" y="1110.2492">Flow&lt;Result&lt;Unit&gt;&gt; (Succès/Échec)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="738.5" x2="780.5" y1="1152.7643" y2="1152.7643"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="780.5" x2="780.5" y1="1152.7643" y2="1165.7643"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="733.5" x2="780.5" y1="1165.7643" y2="1165.7643"/><polygon fill="#A80036" points="743.5,1161.7643,733.5,1165.7643,743.5,1169.7643,739.5,1165.7643" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="745.5" y="1146.9553">Gère le résultat (met à jour uiState si erreur)</text><rect fill="#EEEEEE" filter="url(#f1g3kq3zioq744)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2591" x="3" y="1190.6173"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2594" y1="1190.6173" y2="1190.6173"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2594" y1="1193.6173" y2="1193.6173"/><rect fill="#EEEEEE" filter="url(#f1g3kq3zioq744)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="361" x="1118" y="1178.7643"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="344" x="1124" y="1196.6613">Phase 3: Synchronisation en Temps Réel et Affichage</text><path d="M276,1219.4703 L276,1282.4703 L2589,1282.4703 L2589,1229.4703 L2579,1219.4703 L276,1219.4703 " fill="#FBFB77" filter="url(#f1g3kq3zioq744)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2579,1219.4703 L2579,1229.4703 L2589,1229.4703 L2579,1219.4703 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="1195.5" y="1238.3673">La nouvelle écriture dans Firestore déclenche</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="1195.5" y="1256.0733">automatiquement une mise à jour pour tous les clients</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="461" x="1195.5" y="1273.7793">abonnés (y compris notre propre ChatViewModel via getMessagesForGroup).</text><polygon fill="#A80036" points="2273,1311.2943,2263,1315.2943,2273,1319.2943,2269,1315.2943" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2267" x2="2532" y1="1315.2943" y2="1315.2943"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="2314" y="1309.4853">Nouvelle donnée disponible</text><polygon fill="#A80036" points="1907,1343.0004,1897,1347.0004,1907,1351.0004,1903,1347.0004" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1901" x2="2261" y1="1347.0004" y2="1347.0004"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="342" x="1908" y="1341.1914">(Le Flow `getMessagesForGroup` émet une nouvelle liste)</text><polygon fill="#A80036" points="749.5,1374.7064,739.5,1378.7064,749.5,1382.7064,745.5,1378.7064" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="743.5" x2="1895" y1="1378.7064" y2="1378.7064"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="1224.25" y="1372.8974">Nouvelle Flow&lt;List&lt;Message&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="738.5" x2="780.5" y1="1410.4124" y2="1410.4124"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="780.5" x2="780.5" y1="1410.4124" y2="1423.4124"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="780.5" y1="1423.4124" y2="1423.4124"/><polygon fill="#A80036" points="749.5,1419.4124,739.5,1423.4124,749.5,1427.4124,745.5,1423.4124" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="745.5" y="1404.6034">Met à jour _messages (StateFlow)</text><polygon fill="#A80036" points="349.5,1451.1184,339.5,1455.1184,349.5,1459.1184,345.5,1455.1184" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="343.5" x2="732.5" y1="1455.1184" y2="1455.1184"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="350.5" y="1449.3094">Met à jour la liste des messages (via observation du StateFlow)</text><polygon fill="#A80036" points="37.5,1482.8244,27.5,1486.8244,37.5,1490.8244,33.5,1486.8244" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31.5" x2="332.5" y1="1486.8244" y2="1486.8244"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="41" y="1481.0154">Le nouveau message apparaît instantanément</text><!--MD5=[1039ea8e3b060b67aa95456fea0cbe07]
@startuml
skinparam handwritten false
skinparam sequenceMessageAlign center
skinparam ParticipantPadding 20
skinparam BoxPadding 10

actor User as Utilisateur
participant "ChatScreen\n(Composable)" as ChatUI
participant "ChatViewModel" as ChatVM
participant "AuthRepository\n(Interface)" as AuthRepoI
participant "AuthRepositoryImpl\n(Data)" as AuthRepoImpl
participant "SendMessageUseCase" as SendMessageUC
participant "MessageRepository\n(Interface)" as MessageRepoI
participant "MessageRepositoryImpl\n(Data)" as MessageRepoImpl
participant "FirestoreHelper" as FirestoreH
database "Firebase\nFirestore DB" as FirestoreDB

title Scénario d'Envoi d'un Message Texte dans le Chat

== Phase 1: Initialisation (Chargement de l'utilisateur et des messages) ==
Utilisateur -> ChatUI : Accède à l'écran de chat (groupId)
activate ChatUI
ChatUI -> ChatVM : Initialisation (collecte uiState, messages)
deactivate ChatUI
activate ChatVM
ChatVM -> AuthRepoI : getCurrentUser()
activate AuthRepoImpl
AuthRepoImpl -> FirestoreH : getDocument("users", currentUserId)
FirestoreH - -> AuthRepoImpl : User
AuthRepoImpl - -> ChatVM : Flow<Result<User?>>
deactivate AuthRepoImpl
ChatVM -> ChatVM : Met à jour uiState.currentUserName
ChatVM -> MessageRepoI : getMessagesForGroup(groupId)
activate MessageRepoImpl
MessageRepoImpl -> FirestoreH : getCollection("groups/groupId/messages")
FirestoreH -> FirestoreDB : Lit messages en temps réel (écoute)
FirestoreDB - -> FirestoreH : Liste de Messages (initiale et mises à jour)
FirestoreH - -> MessageRepoImpl : Flow<List<Message>>
deactivate FirestoreH
MessageRepoImpl - -> ChatVM : Flow<List<Message>>
deactivate MessageRepoImpl
ChatVM -> ChatUI : Met à jour la liste des messages
deactivate ChatVM
activate ChatUI
ChatUI -> Utilisateur : Affiche l'historique du chat
deactivate ChatUI

== Phase 2: Saisie et Envoi du Message ==
Utilisateur -> ChatUI : Saisit "Bonjour le groupe !"
Utilisateur -> ChatUI : Clique sur le bouton "Envoyer"
activate ChatUI
ChatUI -> ChatVM : sendMessage("Bonjour le groupe !")
deactivate ChatUI
activate ChatVM
ChatVM -> ChatVM : Crée l'objet Message (avec senderId, senderName)
ChatVM -> ChatVM : Met à jour uiState (sendMessageError = null)
ChatVM -> SendMessageUC : invoke(groupId, message)
activate SendMessageUC
SendMessageUC -> MessageRepoI : sendMessage(groupId, message)
activate MessageRepoImpl
MessageRepoImpl -> FirestoreH : addDocument("groups/groupId/messages", message)
activate FirestoreH
FirestoreH -> FirestoreDB : Écrit le nouveau message
FirestoreDB - -> FirestoreH : Confirmation d'écriture
deactivate FirestoreDB
deactivate FirestoreH
MessageRepoImpl - -> SendMessageUC : Flow<Result<Unit>> (Succès/Échec)
deactivate MessageRepoImpl
SendMessageUC - -> ChatVM : Flow<Result<Unit>> (Succès/Échec)
deactivate SendMessageUC
ChatVM -> ChatVM : Gère le résultat (met à jour uiState si erreur)
deactivate ChatVM

== Phase 3: Synchronisation en Temps Réel et Affichage ==
note over FirestoreDB, ChatUI
  La nouvelle écriture dans Firestore déclenche
  automatiquement une mise à jour pour tous les clients
  abonnés (y compris notre propre ChatViewModel via getMessagesForGroup).
end note
FirestoreDB -> FirestoreH : Nouvelle donnée disponible
FirestoreH -> MessageRepoImpl : (Le Flow `getMessagesForGroup` émet une nouvelle liste)
MessageRepoImpl - -> ChatVM : Nouvelle Flow<List<Message>>
activate ChatVM
ChatVM -> ChatVM : Met à jour _messages (StateFlow)
ChatVM -> ChatUI : Met à jour la liste des messages (via observation du StateFlow)
deactivate ChatVM
activate ChatUI
ChatUI -> Utilisateur : Le nouveau message apparaît instantanément
deactivate ChatUI
@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.10+7-Debian-1deb13u1
Operating System: Linux
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>