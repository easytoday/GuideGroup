<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2315px" preserveAspectRatio="none" style="width:2973px;height:2315px;" version="1.1" viewBox="0 0 2973 2315" width="2973px" zoomAndPan="magnify"><defs><filter height="300%" id="feuhrbujlbbo6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="355" x="1304.75" y="29.2419">Scénario d'Ajout d'un Point d'Intérêt (POI)</text><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="385" y="206.9958"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="385" y="659.88"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="385" y="768.9981"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="1262.6744" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="385" y="948.5282"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="390" y="1221.4522"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="498.8661" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="390" y="1712.3364"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="373.7662" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="395" y="1837.4363"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="400" y="2170.4965"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="421.1782" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="805" y="238.7018"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="319.63" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="805" y="800.7041"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="459.1782" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="805" y="1253.1582"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="76.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="805" y="2094.0845"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="63.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1528.5" y="270.4078"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="190.2361" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1757" y="1374.2762"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="126.8241" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2263" y="501.3499"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="126.8241" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2263" y="1405.9822"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="63.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2661" y="1437.6883"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="252.924" style="stroke: #000000; stroke-width: 2.0;" width="1249" x="13" y="860.4101"/><rect fill="#FFFFFF" height="125.0999" style="stroke: none; stroke-width: 1.0;" width="1249" x="13" y="988.2342"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="252.924" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="13" y="1624.2183"/><rect fill="#FFFFFF" height="125.0999" style="stroke: none; stroke-width: 1.0;" width="1334" x="13" y="1752.0424"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="46" x2="46" y1="127.5838" y2="2220.2025"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="389.5" x2="389.5" y1="127.5838" y2="2220.2025"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="809.5" x2="809.5" y1="127.5838" y2="2220.2025"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1346.5" x2="1346.5" y1="127.5838" y2="2220.2025"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1533.5" x2="1533.5" y1="127.5838" y2="2220.2025"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1761.5" x2="1761.5" y1="127.5838" y2="2220.2025"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2010.5" x2="2010.5" y1="127.5838" y2="2220.2025"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2267.5" x2="2267.5" y1="127.5838" y2="2220.2025"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2666" x2="2666" y1="127.5838" y2="2220.2025"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2900" x2="2900" y1="127.5838" y2="2220.2025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="23" y="123.4818">Guide</text><ellipse cx="46" cy="51.5158" fill="#FEFECE" filter="url(#feuhrbujlbbo6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M46,59.5158 L46,86.5158 M33,67.5158 L59,67.5158 M46,86.5158 L33,101.5158 M46,86.5158 L59,101.5158 " fill="none" filter="url(#feuhrbujlbbo6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="23" y="2234.1684">Guide</text><ellipse cx="46" cy="2248.2704" fill="#FEFECE" filter="url(#feuhrbujlbbo6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M46,2256.2704 L46,2283.2704 M33,2264.2704 L59,2264.2704 M46,2283.2704 L33,2298.2704 M46,2283.2704 L59,2298.2704 " fill="none" filter="url(#feuhrbujlbbo6)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="105" x="335.5" y="70.4479"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="350" y="92.4139">MapScreen</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="342.5" y="111.4818">(Composable)</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="105" x="335.5" y="2219.2025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="350" y="2241.1684">MapScreen</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="342.5" y="2260.2364">(Composable)</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="749.5" y="89.5158"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="756.5" y="111.4818">MapViewModel</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="749.5" y="2219.2025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="756.5" y="2241.1684">MapViewModel</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="1286.5" y="70.4479"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1293.5" y="92.4139">AuthRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="1310.5" y="111.4818">(Interface)</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="1286.5" y="2219.2025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1293.5" y="2241.1684">AuthRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="1310.5" y="2260.2364">(Interface)</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1457.5" y="70.4479"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="1464.5" y="92.4139">AuthRepositoryImpl</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="1512" y="111.4818">(Data)</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1457.5" y="2219.2025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="1464.5" y="2241.1684">AuthRepositoryImpl</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="1512" y="2260.2364">(Data)</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="201" x="1659.5" y="89.5158"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="187" x="1666.5" y="111.4818">AddPointOfInterestUseCase</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="201" x="1659.5" y="2219.2025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="187" x="1666.5" y="2241.1684">AddPointOfInterestUseCase</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="1914.5" y="70.4479"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="1921.5" y="92.4139">PointOfInterestRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="1974" y="111.4818">(Interface)</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="1914.5" y="2219.2025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="1921.5" y="2241.1684">PointOfInterestRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="1974" y="2260.2364">(Interface)</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="219" x="2156.5" y="70.4479"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="205" x="2163.5" y="92.4139">PointOfInterestRepositoryImpl</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="2246.5" y="111.4818">(Data)</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="219" x="2156.5" y="2219.2025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="205" x="2163.5" y="2241.1684">PointOfInterestRepositoryImpl</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="2246.5" y="2260.2364">(Data)</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2605" y="89.5158"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2612" y="111.4818">FirestoreHelper</text><rect fill="#FEFECE" filter="url(#feuhrbujlbbo6)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2605" y="2219.2025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2612" y="2241.1684">FirestoreHelper</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="2868.5" y="104.4139">Firebase</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="2856" y="123.4818">Firestore DB</text><path d="M2882,53.4479 C2882,43.4479 2900,43.4479 2900,43.4479 C2900,43.4479 2918,43.4479 2918,53.4479 L2918,79.4479 C2918,89.4479 2900,89.4479 2900,89.4479 C2900,89.4479 2882,89.4479 2882,79.4479 L2882,53.4479 " fill="#FEFECE" filter="url(#feuhrbujlbbo6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2882,53.4479 C2882,63.4479 2900,63.4479 2900,63.4479 C2900,63.4479 2918,63.4479 2918,53.4479 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="2868.5" y="2234.1684">Firebase</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="2856" y="2253.2364">Firestore DB</text><path d="M2882,2267.3383 C2882,2257.3383 2900,2257.3383 2900,2257.3383 C2900,2257.3383 2918,2257.3383 2918,2267.3383 L2918,2293.3383 C2918,2303.3383 2900,2303.3383 2900,2303.3383 C2900,2303.3383 2882,2303.3383 2882,2293.3383 L2882,2267.3383 " fill="#FEFECE" filter="url(#feuhrbujlbbo6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2882,2267.3383 C2882,2277.3383 2900,2277.3383 2900,2277.3383 C2900,2277.3383 2918,2277.3383 2918,2267.3383 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="385" y="206.9958"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="385" y="659.88"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="385" y="768.9981"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="1262.6744" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="385" y="948.5282"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="390" y="1221.4522"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="498.8661" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="390" y="1712.3364"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="373.7662" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="395" y="1837.4363"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="400" y="2170.4965"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="421.1782" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="805" y="238.7018"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="319.63" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="805" y="800.7041"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="459.1782" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="805" y="1253.1582"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="76.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="805" y="2094.0845"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="63.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1528.5" y="270.4078"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="190.2361" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1757" y="1374.2762"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="126.8241" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2263" y="501.3499"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="126.8241" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2263" y="1405.9822"/><rect fill="#FFFFFF" filter="url(#feuhrbujlbbo6)" height="63.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2661" y="1437.6883"/><rect fill="#EEEEEE" filter="url(#feuhrbujlbbo6)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2958.5" x="3" y="159.4368"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2961.5" y1="159.4368" y2="159.4368"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2961.5" y1="162.4368" y2="162.4368"/><rect fill="#EEEEEE" filter="url(#feuhrbujlbbo6)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="307" x="1328.75" y="147.5838"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="290" x="1334.75" y="165.4808">Phase 1: Initialisation et Vérification du Rôle</text><polygon fill="#A80036" points="373,202.9958,383,206.9958,373,210.9958,377,206.9958" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="379" y1="206.9958" y2="206.9958"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="106.5" y="201.1868">Accède à l'écran de la carte (groupId)</text><polygon fill="#A80036" points="793,234.7018,803,238.7018,793,242.7018,797,238.7018" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="390" x2="799" y1="238.7018" y2="238.7018"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="458" y="232.8928">Initialisation (collecte uiState, pointsOfInterest)</text><polygon fill="#A80036" points="1335,266.4078,1345,270.4078,1335,274.4078,1339,270.4078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="1341" y1="270.4078" y2="270.4078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="1030" y="264.5988">getCurrentUser()</text><polygon fill="#A80036" points="2654,298.1138,2664,302.1138,2654,306.1138,2658,302.1138" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1538.5" x2="2660" y1="302.1138" y2="302.1138"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1990.75" y="296.3048">getDocument("users", currentUserId)</text><polygon fill="#A80036" points="1544.5,329.8199,1534.5,333.8199,1544.5,337.8199,1540.5,333.8199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1538.5" x2="2665" y1="333.8199" y2="333.8199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="2047.75" y="328.0109">User (inclut 'role')</text><polygon fill="#A80036" points="826,361.5259,816,365.5259,826,369.5259,822,365.5259" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="820" x2="1346" y1="365.5259" y2="365.5259"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="1003.5" y="359.7169">Flow&amp;lt;Result&amp;lt;User?&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="857" y1="397.2319" y2="397.2319"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="857" x2="857" y1="397.2319" y2="410.2319"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="857" y1="410.2319" y2="410.2319"/><polygon fill="#A80036" points="826,406.2319,816,410.2319,826,414.2319,822,410.2319" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="822" y="391.4229">Met à jour uiState.userRole</text><path d="M820,423.2319 L820,468.2319 L1087,468.2319 L1087,433.2319 L1077,423.2319 L820,423.2319 " fill="#FBFB77" filter="url(#feuhrbujlbbo6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1077,423.2319 L1077,433.2319 L1087,433.2319 L1077,423.2319 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="826" y="442.1289">Le rôle de l'utilisateur est maintenant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="826" y="459.8349">disponible pour la logique d'ajout de POI.</text><polygon fill="#A80036" points="1998.5,497.3499,2008.5,501.3499,1998.5,505.3499,2002.5,501.3499" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="2004.5" y1="501.3499" y2="501.3499"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="1295.75" y="495.5409">getPointsOfInterestForGroup(groupId)</text><polygon fill="#A80036" points="2654,529.056,2664,533.056,2654,537.056,2658,533.056" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2273" x2="2660" y1="533.056" y2="533.056"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="298" x="2320.5" y="527.247">getCollection("groups/groupId/pointsOfInterest")</text><polygon fill="#A80036" points="2888,560.762,2898,564.762,2888,568.762,2892,564.762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2666" x2="2894" y1="564.762" y2="564.762"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="2695" y="558.953">Lit POI en temps réel (écoute)</text><polygon fill="#A80036" points="2677,592.468,2667,596.468,2677,600.468,2673,596.468" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="2671" x2="2899" y1="596.468" y2="596.468"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="2678" y="590.659">Liste de POI (initiale et mises à jour)</text><polygon fill="#A80036" points="826,624.174,816,628.174,826,632.174,822,628.174" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="820" x2="2267" y1="628.174" y2="628.174"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="1442.5" y="622.365">Flow&amp;lt;List&amp;lt;PointOfInterest&gt;&gt;</text><polygon fill="#A80036" points="406,655.88,396,659.88,406,663.88,402,659.88" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="400" x2="809" y1="659.88" y2="659.88"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="527.5" y="654.071">Met à jour la liste des POI</text><polygon fill="#A80036" points="57,687.586,47,691.586,57,695.586,53,691.586" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="389" y1="691.586" y2="691.586"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="117" y="685.777">Affiche la carte et les POI existants</text><rect fill="#EEEEEE" filter="url(#feuhrbujlbbo6)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2958.5" x="3" y="721.4391"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2961.5" y1="721.4391" y2="721.4391"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2961.5" y1="724.4391" y2="724.4391"/><rect fill="#EEEEEE" filter="url(#feuhrbujlbbo6)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="289" x="1337.75" y="709.586"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="272" x="1343.75" y="727.4831">Phase 2: Déclenchement de l'Ajout de POI</text><polygon fill="#A80036" points="373,764.9981,383,768.9981,373,772.9981,377,768.9981" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="379" y1="768.9981" y2="768.9981"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="94.5" y="763.1891">Long-clic sur un point de la carte (latLng)</text><polygon fill="#A80036" points="793,796.7041,803,800.7041,793,804.7041,797,800.7041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="390" x2="799" y1="800.7041" y2="800.7041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="524" y="794.8951">onMapLongClick(latLng)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="857" y1="832.4101" y2="832.4101"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="857" x2="857" y1="832.4101" y2="845.4101"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="857" y1="845.4101" y2="845.4101"/><polygon fill="#A80036" points="826,841.4101,816,845.4101,826,849.4101,822,845.4101" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="822" y="826.6011">Vérifie uiState.userRole (doit être "guide")</text><path d="M13,860.4101 L76,860.4101 L76,869.4101 L66,879.4101 L13,879.4101 L13,860.4101 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="252.924" style="stroke: #000000; stroke-width: 2.0;" width="1249" x="13" y="860.4101"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="28" y="875.3071">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="91" y="874.169">[Si l'utilisateur est un "guide"]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="857" y1="903.8221" y2="903.8221"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="857" x2="857" y1="903.8221" y2="916.8221"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="857" y1="916.8221" y2="916.8221"/><polygon fill="#A80036" points="826,912.8221,816,916.8221,826,920.8221,822,916.8221" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="822" y="898.0131">Met à jour uiState (showAddPoiDialog = true, tempPoiLocation = latLng)</text><polygon fill="#A80036" points="406,944.5282,396,948.5282,406,952.5282,402,948.5282" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="400" x2="804" y1="948.5282" y2="948.5282"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="548.5" y="942.7192">uiState mis à jour</text><polygon fill="#A80036" points="57,976.2342,47,980.2342,57,984.2342,53,980.2342" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="384" y1="980.2342" y2="980.2342"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="78.5" y="974.4252">Affiche le dialogue "Ajouter un Point d'Intérêt"</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="1262" y1="989.2342" y2="989.2342"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="196" x="18" y="1000.9931">[Si l'utilisateur n'est pas un "guide"]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="857" y1="1028.9221" y2="1028.9221"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="857" x2="857" y1="1028.9221" y2="1041.9221"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="857" y1="1041.9221" y2="1041.9221"/><polygon fill="#A80036" points="826,1037.9221,816,1041.9221,826,1045.9221,822,1041.9221" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="822" y="1023.1131">Met à jour uiState (errorMessage = "...")</text><polygon fill="#A80036" points="406,1069.6281,396,1073.6281,406,1077.6281,402,1073.6281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="400" x2="804" y1="1073.6281" y2="1073.6281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="548.5" y="1067.8191">uiState mis à jour</text><polygon fill="#A80036" points="57,1101.3341,47,1105.3341,57,1109.3341,53,1105.3341" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="384" y1="1105.3341" y2="1105.3341"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="89.5" y="1099.5251">Affiche un message d'erreur (ex: Snackbar)</text><rect fill="#EEEEEE" filter="url(#feuhrbujlbbo6)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2958.5" x="3" y="1142.1871"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2961.5" y1="1142.1871" y2="1142.1871"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2961.5" y1="1145.1871" y2="1145.1871"/><rect fill="#EEEEEE" filter="url(#feuhrbujlbbo6)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="333" x="1315.75" y="1130.3341"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="316" x="1321.75" y="1148.2311">Phase 3: Saisie des Informations et Confirmation</text><polygon fill="#A80036" points="373,1185.7461,383,1189.7461,373,1193.7461,377,1189.7461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="379" y1="1189.7461" y2="1189.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="79" y="1183.9371">Saisit le nom et la description dans le dialogue</text><polygon fill="#A80036" points="378,1217.4522,388,1221.4522,378,1225.4522,382,1221.4522" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="384" y1="1221.4522" y2="1221.4522"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="110" y="1215.6432">Clique sur "Ajouter" dans le dialogue</text><polygon fill="#A80036" points="793,1249.1582,803,1253.1582,793,1257.1582,797,1253.1582" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="395" x2="799" y1="1253.1582" y2="1253.1582"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="484.5" y="1247.3492">addPointOfInterest(name, description)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="857" y1="1284.8642" y2="1284.8642"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="857" x2="857" y1="1284.8642" y2="1297.8642"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="857" y1="1297.8642" y2="1297.8642"/><polygon fill="#A80036" points="826,1293.8642,816,1297.8642,826,1301.8642,822,1297.8642" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="382" x="822" y="1279.0552">Crée l'objet PointOfInterest (avec location, addedBy, timestamp)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="857" y1="1329.5702" y2="1329.5702"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="857" x2="857" y1="1329.5702" y2="1342.5702"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="857" y1="1342.5702" y2="1342.5702"/><polygon fill="#A80036" points="826,1338.5702,816,1342.5702,826,1346.5702,822,1342.5702" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="822" y="1323.7612">Met à jour uiState (isAddingPoi = true, addPoiError = null)</text><polygon fill="#A80036" points="1745,1370.2762,1755,1374.2762,1745,1378.2762,1749,1374.2762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="1751" y1="1374.2762" y2="1374.2762"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="1225" y="1368.4672">invoke(groupId, poi)</text><polygon fill="#A80036" points="1998.5,1401.9822,2008.5,1405.9822,1998.5,1409.9822,2002.5,1405.9822" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1767" x2="2004.5" y1="1405.9822" y2="1405.9822"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="1789.75" y="1400.1732">addPointOfInterest(groupId, poi)</text><polygon fill="#A80036" points="2649,1433.6883,2659,1437.6883,2649,1441.6883,2653,1437.6883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2273" x2="2655" y1="1437.6883" y2="1437.6883"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="330" x="2302" y="1431.8793">addDocument("groups/groupId/pointsOfInterest", poi)</text><polygon fill="#A80036" points="2888,1465.3943,2898,1469.3943,2888,1473.3943,2892,1469.3943" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2671" x2="2894" y1="1469.3943" y2="1469.3943"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="2725.5" y="1463.5853">Écrit le nouveau POI</text><polygon fill="#A80036" points="2677,1497.1003,2667,1501.1003,2677,1505.1003,2673,1501.1003" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="2671" x2="2899" y1="1501.1003" y2="1501.1003"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2713.5" y="1495.2913">Confirmation d'écriture</text><polygon fill="#A80036" points="1778,1528.8063,1768,1532.8063,1778,1536.8063,1774,1532.8063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1772" x2="2267" y1="1532.8063" y2="1532.8063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="1899" y="1526.9973">Flow&amp;lt;Result&amp;lt;Unit&gt;&gt; (Succès/Échec)</text><polygon fill="#A80036" points="826,1560.5123,816,1564.5123,826,1568.5123,822,1564.5123" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="820" x2="1761" y1="1564.5123" y2="1564.5123"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="1170" y="1558.7033">Flow&amp;lt;Result&amp;lt;Unit&gt;&gt; (Succès/Échec)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="857" y1="1596.2183" y2="1596.2183"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="857" x2="857" y1="1596.2183" y2="1609.2183"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="857" y1="1609.2183" y2="1609.2183"/><polygon fill="#A80036" points="826,1605.2183,816,1609.2183,826,1613.2183,822,1609.2183" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="822" y="1590.4093">Gère le résultat</text><path d="M13,1624.2183 L76,1624.2183 L76,1633.2183 L66,1643.2183 L13,1643.2183 L13,1624.2183 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="252.924" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="13" y="1624.2183"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="28" y="1639.1154">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="91" y="1637.9773">[Si ajout réussi (Result.Success)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="857" y1="1667.6304" y2="1667.6304"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="857" x2="857" y1="1667.6304" y2="1680.6304"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="857" y1="1680.6304" y2="1680.6304"/><polygon fill="#A80036" points="826,1676.6304,816,1680.6304,826,1684.6304,822,1680.6304" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="513" x="822" y="1661.8214">Met à jour uiState (isAddingPoi=false, showAddPoiDialog=false, tempPoiLocation=null)</text><polygon fill="#A80036" points="411,1708.3364,401,1712.3364,411,1716.3364,407,1712.3364" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="405" x2="809" y1="1712.3364" y2="1712.3364"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="553.5" y="1706.5274">uiState mis à jour</text><polygon fill="#A80036" points="57,1740.0424,47,1744.0424,57,1748.0424,53,1744.0424" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="389" y1="1744.0424" y2="1744.0424"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="156.5" y="1738.2334">Le dialogue se ferme</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="1347" y1="1753.0424" y2="1753.0424"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="169" x="18" y="1764.8013">[Si ajout échoue (Result.Error)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="810" x2="852" y1="1792.7303" y2="1792.7303"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="852" x2="852" y1="1792.7303" y2="1805.7303"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="811" x2="852" y1="1805.7303" y2="1805.7303"/><polygon fill="#A80036" points="821,1801.7303,811,1805.7303,821,1809.7303,817,1805.7303" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="817" y="1786.9213">Met à jour uiState (isAddingPoi=false, addPoiError="...")</text><polygon fill="#A80036" points="416,1833.4363,406,1837.4363,416,1841.4363,412,1837.4363" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="410" x2="809" y1="1837.4363" y2="1837.4363"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="556" y="1831.6273">uiState mis à jour</text><polygon fill="#A80036" points="57,1865.1423,47,1869.1423,57,1873.1423,53,1869.1423" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="394" y1="1869.1423" y2="1869.1423"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="127.5" y="1863.3333">Affiche l'erreur dans le dialogue</text><rect fill="#EEEEEE" filter="url(#feuhrbujlbbo6)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2958.5" x="3" y="1905.9954"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2961.5" y1="1905.9954" y2="1905.9954"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2961.5" y1="1908.9954" y2="1908.9954"/><rect fill="#EEEEEE" filter="url(#feuhrbujlbbo6)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="470" x="1247.25" y="1894.1423"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="453" x="1253.25" y="1912.0394">Phase 4: Synchronisation en Temps Réel et Affichage du Nouveau POI</text><path d="M333,1934.8484 L333,1997.8484 L2956,1997.8484 L2956,1944.8484 L2946,1934.8484 L333,1934.8484 " fill="#FBFB77" filter="url(#feuhrbujlbbo6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2946,1934.8484 L2946,1944.8484 L2956,1944.8484 L2946,1934.8484 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="1388.25" y="1953.7454">La nouvelle écriture dans Firestore déclenche</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="1388.25" y="1971.4514">automatiquement une mise à jour pour tous les clients</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="500" x="1388.25" y="1989.1574">abonnés (y compris notre propre MapViewModel via getPointsOfInterestForGroup).</text><polygon fill="#A80036" points="2677,2026.6724,2667,2030.6724,2677,2034.6724,2673,2030.6724" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2671" x2="2899" y1="2030.6724" y2="2030.6724"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="2699.5" y="2024.8634">Nouvelle donnée disponible</text><polygon fill="#A80036" points="2279,2058.3784,2269,2062.3784,2279,2066.3784,2275,2062.3784" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2273" x2="2665" y1="2062.3784" y2="2062.3784"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="2280" y="2056.5694">(Le Flow getPointsOfInterestForGroup émet une nouvelle liste)</text><polygon fill="#A80036" points="826,2090.0845,816,2094.0845,826,2098.0845,822,2094.0845" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="820" x2="2267" y1="2094.0845" y2="2094.0845"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="1414.5" y="2088.2755">Nouvelle Flow&amp;lt;List&amp;lt;PointOfInterest&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="815" x2="857" y1="2125.7905" y2="2125.7905"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="857" x2="857" y1="2125.7905" y2="2138.7905"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="857" y1="2138.7905" y2="2138.7905"/><polygon fill="#A80036" points="826,2134.7905,816,2138.7905,826,2142.7905,822,2138.7905" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="822" y="2119.9815">Met à jour uiState.pointsOfInterest (StateFlow)</text><polygon fill="#A80036" points="421,2166.4965,411,2170.4965,421,2174.4965,417,2170.4965" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="415" x2="809" y1="2170.4965" y2="2170.4965"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="376" x="422" y="2164.6875">Met à jour les marqueurs de POI (via observation du StateFlow)</text><polygon fill="#A80036" points="57,2198.2025,47,2202.2025,57,2206.2025,53,2202.2025" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="394" y1="2202.2025" y2="2202.2025"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="63" y="2196.3935">Le nouveau POI apparaît instantanément sur la carte</text><!--MD5=[95ca73d53a33a5b08e6664dc5682c576]
@startuml
skinparam handwritten false
skinparam sequenceMessageAlign center
skinparam ParticipantPadding 20
skinparam BoxPadding 10

actor Guide as Utilisateur
participant "MapScreen\n(Composable)" as MapUI
participant "MapViewModel" as MapVM
participant "AuthRepository\n(Interface)" as AuthRepoI
participant "AuthRepositoryImpl\n(Data)" as AuthRepoImpl
participant "AddPointOfInterestUseCase" as AddPoiUC
participant "PointOfInterestRepository\n(Interface)" as PoiRepoI
participant "PointOfInterestRepositoryImpl\n(Data)" as PoiRepoImpl
participant "FirestoreHelper" as FirestoreH
database "Firebase\nFirestore DB" as FirestoreDB

title Scénario d'Ajout d'un Point d'Intérêt (POI)

== Phase 1: Initialisation et Vérification du Rôle ==
Utilisateur -> MapUI : Accède à l'écran de la carte (groupId)
activate MapUI
MapUI -> MapVM : Initialisation (collecte uiState, pointsOfInterest)
deactivate MapUI
activate MapVM
MapVM -> AuthRepoI : getCurrentUser()
activate AuthRepoImpl
AuthRepoImpl -> FirestoreH : getDocument("users", currentUserId)
FirestoreH - -> AuthRepoImpl : User (inclut 'role')
deactivate FirestoreH
deactivate AuthRepoImpl
AuthRepoI - -> MapVM : Flow&lt;Result&lt;User?>>
MapVM -> MapVM : Met à jour uiState.userRole
note right of MapVM
Le rôle de l'utilisateur est maintenant
disponible pour la logique d'ajout de POI.
end note
MapVM -> PoiRepoI : getPointsOfInterestForGroup(groupId)
activate PoiRepoImpl
PoiRepoImpl -> FirestoreH : getCollection("groups/groupId/pointsOfInterest")
FirestoreH -> FirestoreDB : Lit POI en temps réel (écoute)
FirestoreDB - -> FirestoreH : Liste de POI (initiale et mises à jour)
deactivate FirestoreDB
deactivate FirestoreH
PoiRepoImpl - -> MapVM : Flow&lt;List&lt;PointOfInterest>>
deactivate PoiRepoImpl
MapVM -> MapUI : Met à jour la liste des POI
deactivate MapVM
activate MapUI
MapUI -> Utilisateur : Affiche la carte et les POI existants
deactivate MapUI

== Phase 2: Déclenchement de l'Ajout de POI ==
Utilisateur -> MapUI : Long-clic sur un point de la carte (latLng)
activate MapUI
MapUI -> MapVM : onMapLongClick(latLng)
deactivate MapUI
activate MapVM
MapVM -> MapVM : Vérifie uiState.userRole (doit être "guide")
alt Si l'utilisateur est un "guide"
MapVM -> MapVM : Met à jour uiState (showAddPoiDialog = true, tempPoiLocation = latLng)
MapVM - -> MapUI : uiState mis à jour
activate MapUI
MapUI -> Utilisateur : Affiche le dialogue "Ajouter un Point d'Intérêt"
else Si l'utilisateur n'est pas un "guide"
MapVM -> MapVM : Met à jour uiState (errorMessage = "...")
MapVM - -> MapUI : uiState mis à jour
MapUI -> Utilisateur : Affiche un message d'erreur (ex: Snackbar)
end
deactivate MapVM

== Phase 3: Saisie des Informations et Confirmation ==
Utilisateur -> MapUI : Saisit le nom et la description dans le dialogue
Utilisateur -> MapUI : Clique sur "Ajouter" dans le dialogue
activate MapUI
MapUI -> MapVM : addPointOfInterest(name, description)
deactivate MapUI
activate MapVM
MapVM -> MapVM : Crée l'objet PointOfInterest (avec location, addedBy, timestamp)
MapVM -> MapVM : Met à jour uiState (isAddingPoi = true, addPoiError = null)
MapVM -> AddPoiUC : invoke(groupId, poi)
activate AddPoiUC
AddPoiUC -> PoiRepoI : addPointOfInterest(groupId, poi)
activate PoiRepoImpl
PoiRepoImpl -> FirestoreH : addDocument("groups/groupId/pointsOfInterest", poi)
activate FirestoreH
FirestoreH -> FirestoreDB : Écrit le nouveau POI
FirestoreDB - -> FirestoreH : Confirmation d'écriture
deactivate FirestoreDB
deactivate FirestoreH
PoiRepoImpl - -> AddPoiUC : Flow&lt;Result&lt;Unit>> (Succès/Échec)
deactivate PoiRepoImpl
AddPoiUC - -> MapVM : Flow&lt;Result&lt;Unit>> (Succès/Échec)
deactivate AddPoiUC
MapVM -> MapVM : Gère le résultat
alt Si ajout réussi (Result.Success)
MapVM -> MapVM : Met à jour uiState (isAddingPoi=false, showAddPoiDialog=false, tempPoiLocation=null)
MapVM - -> MapUI : uiState mis à jour
deactivate MapVM
activate MapUI
MapUI -> Utilisateur : Le dialogue se ferme
else Si ajout échoue (Result.Error)
MapVM -> MapVM : Met à jour uiState (isAddingPoi=false, addPoiError="...")
MapVM - -> MapUI : uiState mis à jour
deactivate MapVM
activate MapUI
MapUI -> Utilisateur : Affiche l'erreur dans le dialogue
end

== Phase 4: Synchronisation en Temps Réel et Affichage du Nouveau POI ==
note over FirestoreDB, MapUI
La nouvelle écriture dans Firestore déclenche
automatiquement une mise à jour pour tous les clients
abonnés (y compris notre propre MapViewModel via getPointsOfInterestForGroup).
end note
FirestoreDB -> FirestoreH : Nouvelle donnée disponible
FirestoreH -> PoiRepoImpl : (Le Flow getPointsOfInterestForGroup émet une nouvelle liste)
PoiRepoImpl - -> MapVM : Nouvelle Flow&lt;List&lt;PointOfInterest>>
activate MapVM
MapVM -> MapVM : Met à jour uiState.pointsOfInterest (StateFlow)
MapVM -> MapUI : Met à jour les marqueurs de POI (via observation du StateFlow)
deactivate MapVM
activate MapUI
MapUI -> Utilisateur : Le nouveau POI apparaît instantanément sur la carte
deactivate MapUI
@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.10+7-Debian-1deb13u1
Operating System: Linux
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>